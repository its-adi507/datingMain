<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Love</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="snackbar.css">
    <link rel="stylesheet" href="loader.css">
    <style>
        /* Upload Modal Styles */
        .upload-modal-content {
            max-width: 500px;
            width: 90%;
            background: var(--bg-card);
            color: var(--text-main);
            border-radius: 20px;
            padding: 20px;
        }

        .img-container {
            max-height: 400px;
            /* Limit height for the cropper */
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 10px;
        }

        #imageToCrop {
            max-width: 100%;
            /* Ensure image fits */
            display: block;
        }

        .crop-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn-control {
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-control:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Chat Loader Styles */
        .chat-loader {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: auto;
            margin-bottom: auto;
            /* transform: translate(-50%, -50%); */
            text-align: center;
            z-index: 100;
            transition: all 0.3s ease;
            background-color: var(--light-gray);
        }

        /* Loader at bottom when messages exist */
        .chat-loader.bottom {
            top: auto;
            bottom: 80px;
            transform: translateX(-50%);
        }

        .loader-hearts {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .heart {
            font-size: 32px;
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        /* Smaller hearts when at bottom */
        .chat-loader.bottom .heart {
            font-size: 24px;
        }

        .heart-1 {
            animation-delay: 0s;
        }

        .heart-2 {
            animation-delay: 0.3s;
        }

        .heart-3 {
            animation-delay: 0.6s;
        }

        @keyframes heartBeat {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.7;
            }

            50% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        .loader-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Smaller text when at bottom */
        .chat-loader.bottom .loader-text {
            font-size: 12px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <!-- Navigation / Header (Hidden) -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-heart"></i> LoveSpark
            </div>
        </nav>

        <div class="main-content">
            <!-- Friend List -->
            <aside class="sidebar left-sidebar">
                <h3>Matches <span class="badge">3</span></h3>
                <div class="friend-list">
                    <!-- Friends will be dynamically loaded here -->
                    <p class="loading-matches">Loading matches...</p>
                </div>
            </aside>

            <!-- Chat View -->
            <div class="chat-view">
                <!-- Chat Loader -->


                <div class="chat-header">
                    <button class="chat-back-btn" id="chatBackBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-user-info">
                        <div class="chat-user-avatar">
                            <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/2764.svg"
                                alt="Friend">
                            <span class="status-dot online" id="chatUserStatus"></span>
                        </div>
                        <div class="chat-user-details">
                            <div class="chat-user-name" id="chatUserName">Friend Name</div>
                            <div class="chat-user-status-text" id="chatUserStatusText">Online</div>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be added here -->
                </div>

                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type a message...">
                    <button class="chat-send-btn" id="chatSendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- Swipe Area -->
            <main class="swipe-container">
                <div class="card-stack" id="cardStack">
                    <!-- Empty State -->
                    <div class="empty-state">
                        <i class="fas fa-search-location"></i>
                        <h3>No more profiles nearby</h3>
                        <p>Expand your search settings to see more people.</p>
                    </div>
                </div>

                <div class="swipe-actions">
                    <button class="btn-action reject" id="rejectBtn"><i class="fas fa-times"></i></button>
                    <button class="btn-action super" id="superLikeBtn"><i class="fas fa-star"></i></button>
                    <button class="btn-action like" id="likeBtn"><i class="fas fa-heart"></i></button>
                </div>
            </main>

            <!-- It's a Match Overlay -->
            <div id="matchOverlay" class="match-overlay">
                <div class="match-content">
                    <h1 class="match-title">It's a Match!</h1>
                    <p class="match-subtitle">You and <span id="matchedUserName">Sarah</span> liked each other.</p>
                    <div class="match-images">
                        <img id="myMatchImg" src="" alt="Me" class="match-img">
                        <img id="theirMatchImg" src="" alt="Them" class="match-img">
                    </div>
                    <div class="match-actions">
                        <button id="closeMatchBtn" class="btn-match-close">Keep Swiping</button>
                        <button id="goToChatBtn" class="btn-match-chat">Send Message</button>
                    </div>
                </div>
            </div>

            <!-- Enhanced Profile -->
            <aside class="sidebar right-sidebar profile-section">
                <div class="profile-header-edit">
                    <div class="profile-top-bar">
                        <div class="profile-header-actions">
                            <button class="header-btn reset-swipes-btn" id="resetSwipesBtn" title="Reset Interactions">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="header-btn logout-btn" id="logoutBtn" title="Logout">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                        <button class="save-profile-btn" id="saveProfileBtn">
                            <i class="fas fa-save"></i>
                            <span>Save</span>
                        </button>
                    </div>
                    <div class="profile-pic-container">
                        <img src="" alt="My Profile" id="profilePic">
                        <div class="profile-pic-overlay" id="profilePicEdit">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div class="profile-username" id="profileUsername" contenteditable="false">
                        demo
                    </div>
                    <div class="profile-bio" id="profileBio" contenteditable="false">
                        Love traveling, coffee, and good conversations. Looking for someone to share adventures with!
                        ☕✈️
                    </div>
                    <div class="profile-tags">
                        <span class="tag">Travel <button class="tag-remove">×</button></span>
                        <span class="tag">Coffee <button class="tag-remove">×</button></span>
                        <span class="tag">Music <button class="tag-remove">×</button></span>
                        <span class="tag tag-add" id="addTagBtn"><i class="fas fa-plus"></i> Add Tag</span>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat">
                        <span class="count" id="likesCount"></span>
                        <span class="label">Liked Me</span>
                    </div>
                    <div class="stat">
                        <span class="count" id="likesSentCount"></span>
                        <span class="label">I Liked</span>
                    </div>
                    <div class="stat">
                        <span class="count" id="matchesCount"></span>
                        <span class="label">Matches</span>
                    </div>
                    <div class="stat">
                        <span class="count" id="postsCount"></span>
                        <span class="label">Posts</span>
                    </div>
                </div>

                <div class="profile-posts">
                    <div class="posts-header">
                        <h3>My Posts</h3>
                        <button class="add-post-btn-inline" id="addPostBtn" title="Add Post">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14" />
                            </svg>
                        </button>
                    </div>
                    <div class="posts-grid" id="postsGrid">

                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item" data-target="left-sidebar"><i class="fas fa-user-friends"></i></a>
            <a href="#" class="nav-item active" data-target="swipe-container"><i class="fas fa-fire"></i></a>
            <a href="#" class="nav-item" data-target="right-sidebar"><i class="fas fa-user"></i></a>
        </nav>
        <!-- Reset Swipes Modal -->
        <div id="resetModal" class="modal">
            <div class="modal-content reset-modal-content">
                <h3>Reset Interactions</h3>
                <p>Select which interaction history you would like to clear:</p>
                <div class="reset-options-grid">
                    <button class="btn-reset-option" data-type="liked">
                        <i class="fas fa-heart"></i>
                        <span>All Likes</span>
                    </button>
                    <button class="btn-reset-option" data-type="superliked">
                        <i class="fas fa-star"></i>
                        <span>Superlikes</span>
                    </button>
                    <button class="btn-reset-option" data-type="rejected">
                        <i class="fas fa-times"></i>
                        <span>Rejected</span>
                    </button>
                    <button class="btn-reset-option" data-type="matches">
                        <i class="fas fa-comments"></i>
                        <span>Matches</span>
                    </button>
                </div>
                <button class="btn-close-modal" id="closeResetModal">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="tagModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Choose Your Interests</h3>
                <button class="modal-close" id="closeTagModal">&times;</button>
            </div>
            <div class="selected-tags-preview" id="selectedTagsPreview">
                <!-- Selected tags will appear here -->
            </div>
            <div class="modal-body">
                <div class="tag-categories">
                    <div class="tag-group">
                        <h4>Activities</h4>
                        <div class="tag-options" data-category="Activities">
                            <span class="tag-opt">Travel</span>
                            <span class="tag-opt">Hiking</span>
                            <span class="tag-opt">Gaming</span>
                            <span class="tag-opt">Dancing</span>
                            <span class="tag-opt">Yoga</span>
                            <span class="tag-opt">Photography</span>
                            <span class="tag-opt">Cooking</span>
                        </div>
                    </div>
                    <div class="tag-group">
                        <h4>Interests</h4>
                        <div class="tag-options" data-category="Interests">
                            <span class="tag-opt">Music</span>
                            <span class="tag-opt">Movies</span>
                            <span class="tag-opt">Reading</span>
                            <span class="tag-opt">Art</span>
                            <span class="tag-opt">Nature</span>
                            <span class="tag-opt">Fashion</span>
                            <span class="tag-opt">Coffee</span>
                            <span class="tag-opt">Foodie</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-confirm" id="confirmTagsBtn">Apply Tags</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content confirm-modal-content">
            <div class="confirm-modal-header">
                <i class="fas fa-exclamation-circle"></i>
                <h3 id="confirmTitle">Confirm Action</h3>
            </div>
            <p id="confirmMessage">Are you sure you want to proceed?</p>
            <div class="confirm-modal-actions">
                <button id="cancelConfirmBtn" class="btn-confirm-cancel">Cancel</button>
                <button id="okConfirmBtn" class="btn-confirm-ok">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

    <!-- Upload/Crop Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal-content">
            <div class="modal-header">
                <h3>Update Profile Picture</h3>
                <button class="modal-close" id="closeUploadModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="img-container">
                    <img id="imageToCrop" src="" alt="Picture">
                </div>
                <div class="crop-controls">
                    <button id="zoomInBtn" class="btn-control"><i class="fas fa-search-plus"></i></button>
                    <button id="zoomOutBtn" class="btn-control"><i class="fas fa-search-minus"></i></button>
                    <button id="rotateLeftBtn" class="btn-control"><i class="fas fa-undo"></i></button>
                    <button id="rotateRightBtn" class="btn-control"><i class="fas fa-redo"></i></button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-confirm-cancel" id="cancelUploadBtn">Cancel</button>
                <button class="btn-confirm" id="saveProfilePicBtn">Save Photo</button>
            </div>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="loader.js"></script>
    <script src="snackbar.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>

    <!-- Post Upload Modal -->
    <div class="post-upload-modal" id="postUploadModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <h2>Create Post</h2>

            <!-- Camera UI (Initially Hidden) -->
            <div class="camera-container" id="cameraContainer" style="display: none;">
                <video id="cameraPreview" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
                <div class="camera-controls">
                    <button id="captureBtn" class="camera-btn capture">
                        <div class="inner-circle"></div>
                    </button>
                    <button id="closeCameraBtn" class="camera-btn close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Crop UI (Initially Hidden) -->
            <div class="crop-container" id="postCropContainer" style="display: none;">
                <img id="postCropImage" src="" alt="Image to crop">
            </div>

            <div class="crop-controls" id="postCropControls" style="display: none;">
                <button id="confirmPostBtn" class="btn-primary">Post</button>
                <button id="cancelCropBtn" class="btn-secondary">Cancel</button>
            </div>

            <div class="upload-options" id="uploadOptions">
                <button class="upload-option" id="capturePhotoBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                        <circle cx="12" cy="13" r="4" />
                    </svg>
                    <span>Take Photo</span>
                </button>
                <button class="upload-option" id="postUploadDeviceBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                    <span>Upload from Device</span>
                </button>
            </div>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
            <input type="file" id="postFileInput" accept="image/*" style="display: none;">
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
        </div>
    </div>

</body>

</html>